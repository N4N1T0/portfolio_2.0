---
import type { Experience } from '@/types'
import { Image } from 'astro:assets'
import ExperiencePositionItem from './ExperiencePositionItem.astro'
import { Accordion } from '@/components/ui/accordion'
import { Icons } from '@/components/icons/icons'

interface Props {
  experience: Experience
}

const { companyLogo, companyName, positions, isCurrentEmployer } =
  Astro.props.experience
---

<div class='screen-line-after space-y-4 py-4'>
  <div class='flex items-center gap-3'>
    <div class='flex size-6 shrink-0 items-center justify-center'>
      {
        companyLogo ? (
          <Image
            src={companyLogo}
            alt={companyName}
            width={24}
            height={24}
            quality={100}
            class='rounded-full'
            aria-hidden
          />
        ) : (
          <span class='flex size-2 rounded-full bg-zinc-300 dark:bg-zinc-600' />
        )
      }
    </div>

    <h3 class='text-lg leading-snug font-medium'>
      {companyName}
    </h3>

    {
      isCurrentEmployer && (
        <span class='relative flex items-center justify-center'>
          <span class='absolute inline-flex size-3 animate-ping rounded-full bg-info opacity-50' />
          <span class='relative inline-flex size-2 rounded-full bg-info' />
          <span class='sr-only'>Current Employer</span>
        </span>
      )
    }
  </div>

  <div
    class='relative space-y-4 before:absolute before:left-3 before:h-full before:w-px before:bg-border'
  >
    <Accordion>
      {
        positions.map((position) => {
          const Icon = Icons[position.icon as keyof typeof Icons]
          return (
            <ExperiencePositionItem position={position}>
              <Icon class='size-4 text-foreground' />
            </ExperiencePositionItem>
          )
        })
      }
    </Accordion>
  </div>
</div>
